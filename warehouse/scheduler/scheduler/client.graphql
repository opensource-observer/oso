mutation FinishRun(
  $runId: ID!
  $status: RunStatus!
  $logsUrl: String!
) {
  finishRun(input: {runId: $runId, status: $status, logsUrl: $logsUrl}) {
    success
    message
    run {
      id
    }
  }
}

mutation StartStep(
  $runId: ID!, 
  $name: String!, 
  $displayName: String!
) {
  startStep(input: {runId: $runId, name: $name, displayName: $displayName}) {
    success
    message
    step {
      id
    }
  }
}

mutation FinishStep(
  $stepId: ID!, 
  $status: StepStatus!, 
  $logsUrl: String!
) {
  finishStep(input: {stepId: $stepId, status: $status, logsUrl: $logsUrl}) {
    success
    message
    step {
      id
    }
  }
}

fragment DatasetCommon on Dataset {
  id
  orgId
  displayName
  description
}

fragment LatestDataModel on DataModel {
  id
  orgId
  isEnabled
  createdAt
  latestRelease {
    id
    revision {
      name
      code
      dependsOn {
        alias
        tableId
      }
      hash
      kind
      kindOptions {
        timeColumn
        timeColumnFormat
        batchSize
        lookback
        uniqueKeyColumns
        whenMatchedSql
        mergeFilter
        validFromName
        validToName
        invalidateHardDeletes
        updatedAtColumn
        updatedAtAsValidFrom
        scdColumns
        executionTimeAsValidFrom
      }
      partitionedBy
      schema {
        name
        type
        description
      }
      start
      end
      clusteredBy
      language
    }
  }
}

fragment DataModels on DataModelConnection {
  edges {
    node {
      ...LatestDataModel
    }
  }
}

query GetDataModels($datasetId: ID!) {
  datasets(where: { id: { eq: $datasetId }}) {
    edges {
      node {
        ...DatasetCommon
        typeDefinition {
          ... on DataModelDefinition {
            dataModels(where: { is_enabled: {eq: true}}) {
              ...DataModels
            }
          }
        }
      }
    }
  }
}

mutation StartRun($runId: ID!) {
  startRun(input: {runId: $runId) {
    success
  }
}

mutation FinishRun($runId: ID!, $status: RunStatus!, $logsUrl: String!) {
  finishRun(input: {runId: $runId, status: $status, logsUrl: $logsUrl}) {
    success
  }
}

mutation StartStep($runId: ID!, $name: String!, $displayName: String!) {
  startStep(input: {runId: $runId, name: $name, displayName: $displayName}) {
    success
    step {
      id
    }
  }
}

mutation FinishStep($stepId: ID!, $status: StepStatus!, $logsUrl: String!) {
  finishStep(input: {stepId: $stepId, status: $status, logsUrl: $logsUrl}) {
    success
  }
}

mutation CreateMaterialization(
  $stepId: ID!
  $tableId: ID!
  $warehouseFqn: String!
  $schema: [DataModelColumnInput!]!
) {
  createMaterialization(
    stepId: $stepId
    tableId: $tableId
    warehouseFqn: $warehouseFqn
    schema: $schema
  ) {
    id
  }
}