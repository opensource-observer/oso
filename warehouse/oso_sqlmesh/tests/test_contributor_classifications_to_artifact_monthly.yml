test_contributor_classifications_to_artifact_monthly:
  model: oso.contributor_classifications_to_artifact_monthly
  vars:
    start: 2024-01-01
    end: 2024-01-31
  inputs:
    oso.contributor_active_days_to_artifact_monthly:
      rows:
      # Full-time contributor to artifact_1 (25 active days out of 31)
      - to_artifact_id: artifact_1
        from_artifact_id: contributor_1
        event_source: GITHUB
        metrics_sample_date: 2024-01-01
        metric: contributor_active_days
        amount: 25
      # Part-time contributor to artifact_1 (7 active days out of 31)
      - to_artifact_id: artifact_1
        from_artifact_id: contributor_2
        event_source: GITHUB
        metrics_sample_date: 2024-01-01
        metric: contributor_active_days
        amount: 7
      # Full-time contributor to artifact_2 (28 active days out of 31)
      - to_artifact_id: artifact_2
        from_artifact_id: contributor_3
        event_source: GITHUB
        metrics_sample_date: 2024-01-01
        metric: contributor_active_days
        amount: 28
    oso.int_first_contribution_to_artifact:
      rows:
      # First contribution for contributor_1 was in 2023 (not new)
      - time: 2023-05-20
        event_source: GITHUB
        from_artifact_id: contributor_1
        to_artifact_id: artifact_1
      # First contribution for contributor_2 was in current period (new contributor)
      - time: 2024-01-12
        event_source: GITHUB
        from_artifact_id: contributor_2
        to_artifact_id: artifact_1
      # First contribution for contributor_3 was in current period (new contributor)
      - time: 2024-01-05
        event_source: GITHUB
        from_artifact_id: contributor_3
        to_artifact_id: artifact_2
    oso.int_events_daily__github_with_lag:
      rows:
      # contributor_1 had some historical activity
      - bucket_day: 2023-12-20
        event_source: GITHUB
        from_artifact_id: contributor_1
        to_artifact_id: artifact_1
        event_type: COMMIT_CODE
        last_event: 2023-12-20
  outputs:
    query:
      partial: true
      rows:
      # Full-time contributors (active_days / 31 >= 10/30 = 0.33)
      # contributor_1: 25/31 = 0.81 >= 0.33 (full-time)
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_artifact_id: artifact_1
        from_artifact_id: ''
        metric: full_time_contributors_monthly
        amount: 1
      # contributor_3: 28/31 = 0.90 >= 0.33 (full-time)
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_artifact_id: artifact_2
        from_artifact_id: ''
        metric: full_time_contributors_monthly
        amount: 1
      # Part-time contributors (active_days / 31 < 10/30 = 0.33)
      # contributor_2: 7/31 = 0.23 < 0.33 (part-time)
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_artifact_id: artifact_1
        from_artifact_id: ''
        metric: part_time_contributors_monthly
        amount: 1
      # New contributors (first contribution in current period)
      # contributor_2 to artifact_1
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_artifact_id: artifact_1
        from_artifact_id: ''
        metric: new_contributors_monthly
        amount: 1
      # contributor_3 to artifact_2
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_artifact_id: artifact_2
        from_artifact_id: ''
        metric: new_contributors_monthly
        amount: 1
      # Active contributors (all contributors)
      # artifact_1 has 2 active contributors
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_artifact_id: artifact_1
        from_artifact_id: ''
        metric: active_contributors_monthly
        amount: 2
      # artifact_2 has 1 active contributor
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_artifact_id: artifact_2
        from_artifact_id: ''
        metric: active_contributors_monthly
        amount: 1


test_new_contributors_monthly_multi_month:
  model: oso.contributor_classifications_to_artifact_monthly
  vars:
    start: 2024-01-01
    end: 2024-02-29
  inputs:
    oso.contributor_active_days_to_artifact_monthly:
      rows:
      # Month 1 activity
      - to_artifact_id: artifact_1
        from_artifact_id: contributor_1
        event_source: GITHUB
        metrics_sample_date: 2024-01-01
        metric: contributor_active_days
        amount: 10
      # Month 2 activity
      - to_artifact_id: artifact_1
        from_artifact_id: contributor_1
        event_source: GITHUB
        metrics_sample_date: 2024-02-01
        metric: contributor_active_days
        amount: 10
      - to_artifact_id: artifact_1
        from_artifact_id: contributor_2
        event_source: GITHUB
        metrics_sample_date: 2024-02-01
        metric: contributor_active_days
        amount: 10
      - to_artifact_id: artifact_1
        from_artifact_id: contributor_3
        event_source: GITHUB
        metrics_sample_date: 2024-02-01
        metric: contributor_active_days
        amount: 10
      - to_artifact_id: artifact_1
        from_artifact_id: contributor_4
        event_source: GITHUB
        metrics_sample_date: 2024-02-01
        metric: contributor_active_days
        amount: 10
    oso.int_first_contribution_to_artifact:
      rows:
      # New contributor in month 1
      - time: 2024-01-15
        event_source: GITHUB
        from_artifact_id: contributor_1
        to_artifact_id: artifact_1
      # 3 new contributors in month 2
      - time: 2024-02-10
        event_source: GITHUB
        from_artifact_id: contributor_2
        to_artifact_id: artifact_1
      - time: 2024-02-15
        event_source: GITHUB
        from_artifact_id: contributor_3
        to_artifact_id: artifact_1
      - time: 2024-02-20
        event_source: GITHUB
        from_artifact_id: contributor_4
        to_artifact_id: artifact_1
    oso.int_events_daily__github_with_lag:
      rows:
      - bucket_day: 2024-01-15
        event_source: GITHUB
        from_artifact_id: contributor_1
        to_artifact_id: artifact_1
        event_type: COMMIT_CODE
        last_event: 2024-01-15
      - bucket_day: 2024-02-10
        event_source: GITHUB
        from_artifact_id: contributor_2
        to_artifact_id: artifact_1
        event_type: PULL_REQUEST_OPENED
        last_event: 2024-02-10
  outputs:
    query:
      partial: true
      rows:
      # Month 1 should have 1 new contributor
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_artifact_id: artifact_1
        from_artifact_id: ''
        metric: new_contributors_monthly
        amount: 1
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_artifact_id: artifact_1
        from_artifact_id: ''
        metric: active_contributors_monthly
        amount: 1
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_artifact_id: artifact_1
        from_artifact_id: ''
        metric: part_time_contributors_monthly
        amount: 1
      # Month 2 should have 3 new contributors
      - metrics_sample_date: 2024-02-01
        event_source: GITHUB
        to_artifact_id: artifact_1
        from_artifact_id: ''
        metric: new_contributors_monthly
        amount: 3
      - metrics_sample_date: 2024-02-01
        event_source: GITHUB
        to_artifact_id: artifact_1
        from_artifact_id: ''
        metric: active_contributors_monthly
        amount: 4
      - metrics_sample_date: 2024-02-01
        event_source: GITHUB
        to_artifact_id: artifact_1
        from_artifact_id: ''
        metric: full_time_contributors_monthly
        amount: 4
