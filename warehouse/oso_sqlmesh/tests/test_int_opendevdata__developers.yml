test_int_opendevdata__developers_single_entry:
  model: oso.int_opendevdata__developers
  inputs:
    oso.stg_opendevdata__commits:
      rows:
        - canonical_developer_id: 101
          commit_author_name: "Open Dev"
          commit_author_email: "dev@open.com"
          created_at: "2024-01-01 10:00:00"
    oso.stg_opendevdata__canonical_developers:
      rows:
        - id: 101
          primary_github_user_id: "gh_123"
  outputs:
    query:
      rows:
        - canonical_developer_id: 101
          primary_github_user_id: "gh_123"
          author_name: "Open Dev"
          author_email: "dev@open.com"
          hashed_author_email: "34c6fceca75e456f25e7e99531e2425c6c1de443@open.com"
          valid_from: "2024-01-01 10:00:00"
          valid_to: null

test_int_opendevdata__developers_scd_logic:
  model: oso.int_opendevdata__developers
  inputs:
    oso.stg_opendevdata__commits:
      rows:
        - canonical_developer_id: 202
          commit_author_name: "Original Name"
          commit_author_email: "original@test.com"
          created_at: "2024-01-01 10:00:00"
        - canonical_developer_id: 202
          commit_author_name: "New Name"
          commit_author_email: "original@test.com"
          created_at: "2024-02-01 12:00:00"
        # Duplicate record for first state
        - canonical_developer_id: 202
          commit_author_name: "Original Name"
          commit_author_email: "original@test.com"
          created_at: "2024-01-15 10:00:00"
    oso.stg_opendevdata__canonical_developers:
      rows:
        - id: 202
          primary_github_user_id: "gh_456"
  outputs:
    query:
      rows:
        - canonical_developer_id: 202
          primary_github_user_id: "gh_456"
          author_name: "Original Name"
          author_email: "original@test.com"
          hashed_author_email: "d73ef92426f2b11dfc4aed4d4bfc41c49ee1087c@test.com"
          valid_from: "2024-01-01 10:00:00"
          valid_to: "2024-02-01 12:00:00"
        - canonical_developer_id: 202
          primary_github_user_id: "gh_456"
          author_name: "New Name"
          author_email: "original@test.com"
          hashed_author_email: "d73ef92426f2b11dfc4aed4d4bfc41c49ee1087c@test.com"
          valid_from: "2024-02-01 12:00:00"
          valid_to: null

test_int_opendevdata__developers_filter_nulls:
  model: oso.int_opendevdata__developers
  inputs:
    oso.stg_opendevdata__commits:
      rows:
        - canonical_developer_id: null
          commit_author_name: "Ghost"
          commit_author_email: "ghost@test.com"
          created_at: "2024-01-01 10:00:00"
    oso.stg_opendevdata__canonical_developers:
      rows: []
  outputs:
    query:
      rows: []
