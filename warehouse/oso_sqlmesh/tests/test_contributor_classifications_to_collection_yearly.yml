test_contributor_classifications_to_collection_yearly:
  model: oso.contributor_classifications_to_collection_yearly
  vars:
    start: 2024-01-01
    end: 2024-12-31
  inputs:
    oso.contributor_active_days_to_collection_yearly:
      rows:
      # Full-time contributor to collection_1 (180 active days out of 366)
      - to_collection_id: collection_1
        from_artifact_id: contributor_1
        event_source: GITHUB
        metrics_sample_date: 2024-01-01
        metric: contributor_active_days
        amount: 180
      # Part-time contributor to collection_1 (60 active days out of 366)
      - to_collection_id: collection_1
        from_artifact_id: contributor_2
        event_source: GITHUB
        metrics_sample_date: 2024-01-01
        metric: contributor_active_days
        amount: 60
      # Full-time contributor to collection_2 (240 active days out of 366)
      - to_collection_id: collection_2
        from_artifact_id: contributor_3
        event_source: GITHUB
        metrics_sample_date: 2024-01-01
        metric: contributor_active_days
        amount: 240
    oso.int_first_contribution_to_collection:
      rows:
      # First contribution for contributor_1 was in 2023 (not new)
      - time: 2023-02-28 16:45:00
        event_source: GITHUB
        from_artifact_id: contributor_1
        to_collection_id: collection_1
      # First contribution for contributor_2 was in current year (new contributor)
      - time: 2024-08-15 10:20:00
        event_source: GITHUB
        from_artifact_id: contributor_2
        to_collection_id: collection_1
      # First contribution for contributor_3 was in current year (new contributor)
      - time: 2024-03-05 13:30:00
        event_source: GITHUB
        from_artifact_id: contributor_3
        to_collection_id: collection_2
    oso.int_events_daily__github_with_lag:
      rows:
      # contributor_1 had some historical activity but was dormant for more than a year
      - bucket_day: 2022-10-10
        event_source: GITHUB
        from_artifact_id: contributor_1
        to_artifact_id: repo_1
        event_type: COMMIT_CODE
        last_event: 2022-10-10
    oso.artifacts_by_collection_v1:
      rows:
      - artifact_id: repo_1
        collection_id: collection_1
      - artifact_id: repo_2
        collection_id: collection_1
      - artifact_id: repo_3
        collection_id: collection_2
    oso.projects_by_collection_v1:
      rows:
      - project_id: project_1 
        collection_id: collection_1
      - project_id: project_1
        collection_id: collection_1
      - project_id: project_2
        collection_id: collection_2
    oso.artifacts_by_project_v1:
      rows:
      - artifact_id: repo_1
        project_id: project_1
      - artifact_id: repo_2
        project_id: project_1
      - artifact_id: repo_3
        project_id: project_2
  outputs:
    query:
      partial: true
      rows:
      # Full-time contributors (active_days / 366 >= 10/30 = 0.33)
      # contributor_1: 180/366 = 0.49 >= 0.33 (full-time)
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_collection_id: collection_1
        from_artifact_id: ''
        metric: full_time_contributors_yearly
        amount: 1
      # contributor_3: 240/366 = 0.66 >= 0.33 (full-time)
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_collection_id: collection_2
        from_artifact_id: ''
        metric: full_time_contributors_yearly
        amount: 1
      # Part-time contributors (active_days / 366 < 10/30 = 0.33)
      # contributor_2: 60/366 = 0.16 < 0.33 (part-time)
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_collection_id: collection_1
        from_artifact_id: ''
        metric: part_time_contributors_yearly
        amount: 1
      # New contributors (first contribution in current year)
      # contributor_2 to collection_1
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_collection_id: collection_1
        from_artifact_id: ''
        metric: new_contributors_yearly
        amount: 1
      # contributor_3 to collection_2
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_collection_id: collection_2
        from_artifact_id: ''
        metric: new_contributors_yearly
        amount: 1
      # Resurrected contributors (contributor_1 was dormant for > 1 year)
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_collection_id: collection_1
        from_artifact_id: ''
        metric: resurrected_contributors_yearly
        amount: 1
      # Active contributors (all contributors)
      # collection_1 has 2 active contributors
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_collection_id: collection_1
        from_artifact_id: ''
        metric: active_contributors_yearly
        amount: 2
      # collection_2 has 1 active contributor
      - metrics_sample_date: 2024-01-01
        event_source: GITHUB
        to_collection_id: collection_2
        from_artifact_id: ''
        metric: active_contributors_yearly
        amount: 1
