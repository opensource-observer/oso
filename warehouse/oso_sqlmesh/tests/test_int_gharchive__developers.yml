test_int_gharchive__developers_single_entry:
  model: oso.int_gharchive__developers
  inputs:
    oso.stg_github__commits:
      rows:
        - actor_id: 123
          actor_login: "dev1"
          author_name: "Developer One"
          author_email: "dev1@example.com"
          created_at: "2024-01-01 10:00:00"
    oso.stg_github__commits_since_20251007:
      rows: []
  outputs:
    query:
      rows:
        - actor_id: 123
          actor_login: "dev1"
          author_name: "Developer One"
          author_email: "dev1@example.com"
          valid_from: "2024-01-01 10:00:00"
          valid_to: null

test_int_gharchive__developers_scd_logic:
  model: oso.int_gharchive__developers
  inputs:
    oso.stg_github__commits:
      rows:
        - actor_id: 456
          actor_login: "old_login"
          author_name: "Dave"
          author_email: "dave@old.com"
          created_at: "2024-01-01 10:00:00"
        - actor_id: 456
          actor_login: "new_login"
          author_name: "Dave"
          author_email: "dave@new.com"
          created_at: "2024-02-01 12:00:00"
        # Duplicate record for first state should not create new row
        - actor_id: 456
          actor_login: "old_login"
          author_name: "Dave"
          author_email: "dave@old.com"
          created_at: "2024-01-15 10:00:00"
    oso.stg_github__commits_since_20251007:
      rows: []
  outputs:
    query:
      rows:
        - actor_id: 456
          actor_login: "old_login"
          author_name: "Dave"
          author_email: "dave@old.com"
          valid_from: "2024-01-01 10:00:00"
          valid_to: "2024-02-01 12:00:00"
        - actor_id: 456
          actor_login: "new_login"
          author_name: "Dave"
          author_email: "dave@new.com"
          valid_from: "2024-02-01 12:00:00"
          valid_to: null

test_int_gharchive__developers_merge_sources:
  model: oso.int_gharchive__developers
  inputs:
    oso.stg_github__commits:
      rows:
        - actor_id: 789
          actor_login: "legacy_dev"
          author_name: "Legacy"
          author_email: "legacy@example.com"
          created_at: "2024-01-01 10:00:00"
    oso.stg_github__commits_since_20251007:
      rows:
        - actor_id: 789
          actor_login: "modern_dev"
          author_name: null
          author_email: null
          created_at: "2026-01-01 10:00:00"
  outputs:
    query:
      rows:
        - actor_id: 789
          actor_login: "legacy_dev"
          author_name: "Legacy"
          author_email: "legacy@example.com"
          valid_from: "2024-01-01 10:00:00"
          valid_to: "2026-01-01 10:00:00"
        - actor_id: 789
          actor_login: "modern_dev"
          author_name: null
          author_email: null
          valid_from: "2026-01-01 10:00:00"
          valid_to: null
