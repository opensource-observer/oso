test_stg_github__comments_since_20251007_basic:
  model: oso.stg_github__comments_since_20251007
  vars:
    start_dt: 2025-11-01
    end_dt: 2025-11-05
  inputs:
    oso.stg_github__events:
      columns:
        created_at: timestamp(6)
      rows:
      # Pull Request Review Comment (v2: missing pull_request fields)
      - id: "event_v2_1"
        created_at: "2025-11-01 10:00:00.000000"
        type: "PullRequestReviewCommentEvent"
        public: true
        repo:
          id: 12345
          name: "owner1/repo1"
          url: "https://api.github.com/repos/owner1/repo1"
        actor:
          id: 1001
          login: "user1"
          gravatar_url: ""
          avatar_url: "https://avatars.githubusercontent.com/u/1001"
          url: "https://api.github.com/users/user1"
        org: null
        other: ""
        # pull_request updated_at and other fields missing
        payload: '{"pull_request": {"number": 1}}'
      # Issue Comment (v2: issue fields mostly intact)
      - id: "event_v2_2"
        created_at: "2025-11-02 14:30:00.000000"
        type: "IssueCommentEvent"
        public: true
        repo:
          id: 67890
          name: "owner2/repo2"
          url: "https://api.github.com/repos/owner2/repo2"
        actor:
          id: 1002
          login: "user2"
          gravatar_url: ""
          avatar_url: "https://avatars.githubusercontent.com/u/1002"
          url: "https://api.github.com/users/user2"
        org: null
        other: ""
        payload: '{"issue": {"number": 5, "created_at": "2024-01-02T12:00:00Z", "updated_at": "2025-11-02T14:30:00Z", "closed_at": null, "state": "open", "comments": 3}}'
  outputs:
    query:
      rows:
      - id: "event_v2_1"
        event_time: "2025-11-01 10:00:00.000000"
        repository_id: 12345
        repository_name: "owner1/repo1"
        actor_id: 1001
        actor_login: "user1"
        type: "PULL_REQUEST_REVIEW_COMMENT"
        number: 1
        # Fallback to event created_at
        created_at: "2025-11-01 10:00:00.000000"
        merged_at: null
        closed_at: null
        state: null
        comments: null
      - id: "event_v2_2"
        event_time: "2025-11-02 14:30:00.000000"
        repository_id: 67890
        repository_name: "owner2/repo2"
        actor_id: 1002
        actor_login: "user2"
        type: "ISSUE_COMMENT"
        number: 5
        created_at: "2024-01-02 12:00:00.000000"
        merged_at: null
        closed_at: null
        state: "open"
        comments: 3.0
